FROM node:22-slim

# Enable corepack for pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

# Copy all package files for pnpm workspaces
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml .npmrc ./
COPY packages/admin/package.json ./packages/admin/
COPY packages/backend/package.json ./packages/backend/
COPY packages/frontend/package.json ./packages/frontend/
COPY packages/editor/package.json ./packages/editor/

# Install dependencies
RUN pnpm install

EXPOSE 3000

WORKDIR /app/packages/admin

CMD ["pnpm", "dev", "--host", "0.0.0.0"]
